version: '{build}'
image: ubuntu
environment:
  access_token:
      secure: XnBi8Mi7PoisgrK4u76B1JxFeZlCgS9VeKWeVnJHrzFqXzfXGhtHexcLYYIfF4eL
  git_email: 
      secure: y9vsgCXsUOccjaCutoaKhoi3f5Vhs5bmOy6i4Tinbds=

pull_requests:
  do_not_increment_build_number: true
branches:
  only:
  - src
nuget:
  disable_publish_on_pr: true
test: off
build_script:
  - cp -r _site _artifacts
  - cd _site
  - git checkout master || git checkout --orphan master
  - cd ..
  - rm -rf _site/**/* || exit 0
  - cp -R _artifacts _site
  - touch _site/.nojekyll
  - echo "cfrenzel.com" > _site/CNAME

deploy_script:
  - git config --global credential.helper store
  - ps: Add-Content "$HOME\.git-credentials" "https://$($env:access_token):x-oauth-basic@github.com`n"
  - git config --global user.email "$($env:access_token)"
  - git config --global user.name "cfrenzel"
  - cd _site
  - git add -A .
  - git commit -m "Deploy to GitHub Pages - $APPVEYOR_BUILD_VERSION"
  - git push origin master